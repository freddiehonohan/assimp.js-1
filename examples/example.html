<!doctype html>
<html>
<div id="container"></div>
<input type="file" id="file-input" />
<input type="file" id="file-output" />
<h3>Contents of the file:</h3>
<pre id="file-content"></pre>
<script src="three.min.js"></script>
<script src="FileSaver.min.js"></script>
<script src="../assimp.js"></script>
<script src="js/assimpToThreeJS.js"></script>
<script>
    // http://stackoverflow.com/questions/3582671/how-to-open-a-local-disk-file-with-javascript
    'use strict';
    var camera, scene, renderer,
        mouseX = 0, mouseY = 0,
	    windowHalfX = window.innerWidth / 2,
	    windowHalfY = window.innerHeight / 2;
        
    init();
    animate();

    function init() {
        camera = new THREE.PerspectiveCamera(70, window.innerWidth / window.innerHeight, 1, 1000);
        camera.position.z = 400;
        scene = new THREE.Scene();
        //var texture = new THREE.TextureLoader().load( 'textures/crate.gif' );
        //var geometry = new THREE.BoxBufferGeometry( 200, 200, 200 );
        //var material = new THREE.MeshBasicMaterial( { map: texture } );
        //mesh = new THREE.Mesh( geometry, material );
        //scene.add( mesh );
        renderer = new THREE.WebGLRenderer();
        renderer.setPixelRatio(window.devicePixelRatio);
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        window.addEventListener('resize', onWindowResize, false);
        document.addEventListener('mousemove', onDocumentMouseMove, false);
    }

    function onWindowResize() {
        windowHalfX = window.innerWidth / 2;
        windowHalfY = window.innerHeight / 2;
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
    }

    function onDocumentMouseMove(event) {
        mouseX = (event.clientX - windowHalfX) / 2;
        mouseY = (event.clientY - windowHalfY) / 2;
    }

    function animate() {
        requestAnimationFrame(animate);
        render();
    }

    function render() {
        camera.position.x += (mouseX - camera.position.x) * .05;
        camera.position.y += (-mouseY - camera.position.y) * .05;
        camera.lookAt(scene.position);
        renderer.render(scene, camera);
    }

    //function onWindowResize() {
    //  camera.aspect = window.innerWidth / window.innerHeight;
    //  camera.updateProjectionMatrix();
    //  renderer.setSize( window.innerWidth, window.innerHeight );
    //}

    //function animate() {
    //  requestAnimationFrame( animate );
    //  //mesh.rotation.x += 0.005;
    //  //mesh.rotation.y += 0.01;
    //  if(scene !== null) {
    //       renderer.render( scene, camera );
    //  }
    //}

    function readSingleFile(e) {
        var file = e.target.files[0];
        if (!file) {
            return;
        }
        var reader = new FileReader();
        reader.onload = function(e) {
            var contents = e.target.result;
            var importScene = AssimpToThreeJS.loadContents(contents);
            scene.add(importScene);
            // possibly add lights if the importScene doesn't have any
        };
        reader.readAsText(file);
    }

    function writeSingleFile(e) {
        var file = e.target.files[0];
        if (!file) {
            return;
        }
        var writer = new FileWriter();
        writer.onsave = function(e) {
            if (scene !== null) {
                var contents = e.target.result;
                AssimpToThreeJS.saveContents(contents, scene);
            }
        };
        writer.writerAsText(file);
    }

    document.getElementById('file-input').addEventListener('change', readSingleFile, false);
    document.getElementById('file-output').addEventListener('change', writeSingleFile, false);
</script>

</html>